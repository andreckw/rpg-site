{% extends "layouts/base.html" %}

{% block titulo %} Ficha | Sombras das Almas {% endblock %}

{% block tela %} Ficha - Sombras das Almas {% endblock %}

{% block conteudo %}

<div class="box">
    Ficha de personagem do Sistema de RPG Sombras das Almas
</div>

<form action="#" method="post">
    <!-- Personagem -->
    <div class="field">
        <h3 class="title is-3">
            Personagem
        </h3>
    </div>

    <div class="field is-grouped">
        <p class="control is-expanded">
            {{ form.nome.label }}
            {{ form.nome(class="input") }}
        </p>
        <p class="control is-expanded">
            {{ form.idade.label }}
            {{ form.idade(class="input") }}
        </p>
        <p class="control is-expanded">
            {{ form.data_nascimento.label }}
            {{ form.data_nascimento(class="input") }}
        </p>
        <p class="control is-expanded">
            {{ form.nivel.label }}
            {{ form.nivel(class="input") }}
        </p>
        
    </div>
    <div class="field is-grouped">
        <p class="control is-expanded">
            {{ form.jogador.label }}
            {{ form.jogador(class="input") }}
        </p>
        <p class="control is-expanded">
            {{ form.altura.label }}
            {{ form.altura(class="input") }}
        </p>
        <p class="control">
            {{ form.sexo.label }}
            <br>
            <span class="select">
                {{ form.sexo }}
            </span>
        </p>
        <p class="control is-expanded">
            {{ form.peso.label }}
            {{ form.peso(class="input") }}
        </p>
        
    </div>

    <hr>

    <!-- Atributos -->
    <div class="columns">
        <div class="column">
            <div class="field">
                <h3 class="title is-3">
                    Atributos
                </h3>
            </div>

            <div class="columns">
                <div class="column field">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ATR</th>
                                <th>Valor</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td> {{ form.forca.label }} </td>
                                <td> {{ form.forca(class="input") }} </td>
                            </tr>
                            <tr>
                                <td> {{ form.destreza.label }} </td>
                                <td> {{ form.destreza(class="input") }} </td>
                            </tr>
                            <tr>
                                <td> {{ form.saude.label }} </td>
                                <td> {{ form.saude(class="input") }} </td>
                            </tr>
                            <tr>
                                <td> {{ form.conhecimento.label }} </td>
                                <td> {{ form.conhecimento(class="input") }} </td>
                            </tr>
                            <tr>
                                <td> {{ form.comunicacao.label }} </td>
                                <td> {{ form.comunicacao(class="input") }} </td>
                            </tr>
                            <tr>
                                <td> {{ form.percepcao.label }} </td>
                                <td> {{ form.percepcao(class="input") }} </td>
                            </tr>
                            <tr>
                                <td> {{ form.mente.label }} </td>
                                <td> {{ form.mente(class="input") }} </td>
                            </tr>
                        </tbody>
                    </table>

                </div>
                <div class="column">
                    <table class="table">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Atual</th>
                                <th>Max</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>PV</td>
                                <td> {{ form.pv_atual(class="input") }} </td>
                                <td> {{ form.pv_max(class="input") }} </td>
                            </tr>
                            <tr>
                                <td>PB</td>
                                <td> {{ form.pb_atual(class="input") }} </td>
                                <td> {{ form.pb_max(class="input") }} </td>
                            </tr>
                            <tr>
                                <td>PA</td>
                                <td> {{ form.pa_atual(class="input") }} </td>
                                <td> {{ form.pa_max(class="input") }} </td>
                            </tr>
                            <tr>
                                <td>AA</td>
                                <td> {{ form.aa_atual(class="input") }} </td>
                                <td> {{ form.aa_max(class="input") }} </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="column">
            <h3 class="title is-3">
                Poder da Alma
            </h3>

            <div class="field">
                <strong>
                    {{ form.soul.label }}
                </strong>
                {{ form.soul(class="textarea") }}
            </div>

            <div class="field">
                <strong>
                    {{ form.aura.label }}
                </strong>
                {{ form.aura(class="textarea") }}
            </div>
        </div>
    </div>

    <div class="columns">
        <div class="column">

            <div class="field is-grouped">
                <p class="control">
                    {{ form.estilo_combate.label(class="title is-3") }}
                    <br>
                    <span class="select">
                        {{ form.estilo_combate }}
                    </span>
                </p>
            </div>

            <hr>

            <div class="field">
                <h3 class="title is-3">
                    Vantagens e Desvantagens
                </h3>

                <button type="button" class="button is-primary" onclick="adicionarVantagem()">
                    Adicionar V&D
                </button>

                <table>
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Tipo</th>
                            <th>Descrição</th>
                            <th>Custo</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="tbody-ved">
                        {% for x in form.van_des %}
                            
                            <tr id="tr-ved-{{ loop.index }}">
                                <td>{{ x.nome(class="input") }}</td>
                                <td>
                                    <p class="control">
                                        <span class="select">
                                            {{ x.tipo }}</td>
                                        </span>
                                    </p>
                                <td>{{ x.desc(class="textarea") }}</td>
                                <td>{{ x.custo(class="input") }}</td>
                                <td>
                                    <button type="button" class="button is-danger" onclick="deletarVantagem(this)">
                                        <span class="icon material-icons">
                                            delete
                                        </span>
                                    </button>
                                </td>
                            </tr>

                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
        </div>
        <div class="column">

        </div>
    </div>
</form>

{% endblock %}

{% block js %}

<script>
    let ultimoV = document.getElementById("tbody-ved").rows.length - 1;
    function adicionarVantagem() {

        ultimoV++;

        var table = document.getElementById("tbody-ved");

        var tr = document.getElementById("tr-ved-1").cloneNode(true);

        table.appendChild(tr);
        consertarIds();
    }

    function deletarVantagem(elem) {

        if (ultimoV == 0) {
            return;
        }

        let td = elem.parentNode;
        let tr = td.parentNode;

        tr.remove();
        ultimoV--;
        consertarIds();
    }


    function consertarIds() {
        let table = document.getElementById("tbody-ved");

        for (i = 0; i < table.rows.length; i++) {
            let tr = table.rows[i];
            
            let id = tr.getAttribute("id");
            tr.setAttribute("id", "tr-ved-"+(i + 1));
            console.log(table.rows[i]);

            for (j = 0; j < (tr.children.length - 1); j++) {
                let td = tr.children[j];
                let ultimoFilho = td.children[0];
                
                if (ultimoFilho.tagName == "P") {
                    ultimoFilho = ultimoFilho.children[0].children[0];
                }

                let id = ultimoFilho.getAttribute("id");
                let name = ultimoFilho.getAttribute("name");

                // Sempre trocar no 7 ate o ultimoIndex
                let idLastCaractere = id.lastIndexOf("-");
                let nameLastCaractere = name.lastIndexOf("-");

                id = id.substring(0, 8) + i + id.substring(idLastCaractere);
                name = name.substring(0, 8) + i + name.substring(idLastCaractere);

                ultimoFilho.setAttribute("id", id)
                ultimoFilho.setAttribute("name", name)
            }
        }
    }

</script>

{% endblock %}